# 可靠的数据传输原理

机制|用途和说明
:-:|:-
校验和|用于检测在一个传输分组中的比特错误
定时器|用于超时/重传一个分组，可能因为该分组在信道中丢失，产生超时事件，接收方可能会收到一个分组的多个冗余副本
序号|用于为发送方流向接收方的数据分组按顺序编号。可使接收方检测出丢失的分组。具有相同序号的分组可使接收方检测出一个分组的冗余副本
确认|接收方用于告诉发送方一个分组已经被正确接收。确认报文可以带着被确认的一个或多个分组报文的序号
否定确认|接收方用于告诉发送方一个分组未被正确接收。否定确认报文通常带着被确认的分组或多个分组的序号
窗口，流水线|发送方也许被限制仅发送那些序号落在一个指定范围内的分组。通过允许一次发送多个分组但未被确认，发送方的利用率可在停等操作模式的基础上得到增加

## 构造可靠数据传输协议

可靠数据传输运输协议利用校验和、序号、定时器、肯定和否定确认分组。

### 自动重传请求协议

控制报文使得接收方可以让发送方知道哪些内容被正确接收，哪些内容接收有误并因此需要重复。基于这样重传机制的可靠数据传输协议被称为`自动重传请求协议（ARQ）`。自动重传请求协议需要三种协议功能来出力比特位差错的情况

#### 差错检测

使用校验和字段实现对方法数据的校验，以知道接收数据是否正常。

#### 接收方反馈

接收方向发送方提供反馈信息，利用一个比特位标识接收成功（ACK）或失败（NAK）。

#### 重传

接收方收到有差错的分组时，发送方将重传该分组报文。

### 比特交替协议

分组序号在0，1之间相互切换，以标识接收的分组的顺序。防止出现发送多次相同分组。

### 倒数定时器

在定时器结束时，仍未收到接收方反馈的信息，立即重传数据

## 流水线可靠数据协议

以不停的方式发送方发送多个分组而无需等待确认。因为发动方发送的分组可以被看成时填充到一条流水线中，故这种技术被称之为`流水线`。

### 实现流水线

- 必须增加序号范围，保证传输中的每个分组都有一个唯一的序号（除了重传）
- 协议的发送方和接收方两端也许不得不缓存多个分组
- 发生错误需要重传，依靠回退N步（GBN）和选择重传（SR）

## 回退N步

当发送方发送了N个分组后，若发现该N分组的前一个分组在计时器超时后仍未返回其确认信息，此时发送方就不得不重新发送出错分组及其后的N分组。窗口回退到出错的分组，当收到该分组后继续前进。

## 选择重传

当发送方移动发送窗口到未被确认的最小序号的分组处，该分组在定时器结束时尚未收到该分组，则重传该分组。倘若收到该分组的回复则窗口继续前进。
